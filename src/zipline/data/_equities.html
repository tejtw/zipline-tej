<!DOCTYPE html>
<!-- Generated by Cython 3.0.12 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: _equities.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.12</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="_equities.c">_equities.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: #</pre>
<pre class='cython code score-8 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: # Copyright 2015 Quantopian, Inc.</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: # Licensed under the Apache License, Version 2.0 (the "License");</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: # you may not use this file except in compliance with the License.</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: # You may obtain a copy of the License at</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #     http://www.apache.org/licenses/LICENSE-2.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: # Unless required by applicable law or agreed to in writing, software</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: # distributed under the License is distributed on an "AS IS" BASIS,</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: # See the License for the specific language governing permissions and</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: # limitations under the License.</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">015</span>: import bcolz</pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_bcolz, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_bcolz, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">016</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: from cpython cimport bool</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: </pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: from numpy import (</pre>
<pre class='cython code score-60 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, __pyx_t_7, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_array, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_float64, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_full);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_full, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_intp, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_uint32);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_uint32, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_zeros, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_4, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_uint64, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">020</span>:     array,</pre>
<pre class='cython code score-26 '>  __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_array);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_array);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 0, __pyx_n_s_array)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_float64);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_float64);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 1, __pyx_n_s_float64)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_full);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_full);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 2, __pyx_n_s_full)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_intp);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_intp);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 3, __pyx_n_s_intp)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_uint32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_uint32);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 4, __pyx_n_s_uint32)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_zeros);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_zeros);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 5, __pyx_n_s_zeros)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_uint64);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_uint64);
  if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, 6, __pyx_n_s_uint64)) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>;
</pre><pre class="cython line score-0">&#xA0;<span class="">021</span>:     float64,</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>:     full,</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:     intp,</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>:     uint32,</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>:     zeros,</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>:     uint64,</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: )</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: from numpy cimport (</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>:     float64_t,</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>:     intp_t,</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>:     ndarray,</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>:     uint32_t,</pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>:     uint8_t,</pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>:     uint64_t,</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: )</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: from numpy.math cimport NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">038</span>: ctypedef object carray_t</pre>
<pre class='cython code score-0 '>typedef PyObject *__pyx_t_7zipline_4data_9_equities_carray_t;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">039</span>: ctypedef object ctable_t</pre>
<pre class='cython code score-0 '>typedef PyObject *__pyx_t_7zipline_4data_9_equities_ctable_t;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">040</span>: ctypedef object Timestamp_t</pre>
<pre class='cython code score-0 '>typedef PyObject *__pyx_t_7zipline_4data_9_equities_Timestamp_t;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">041</span>: ctypedef object DatetimeIndex_t</pre>
<pre class='cython code score-0 '>typedef PyObject *__pyx_t_7zipline_4data_9_equities_DatetimeIndex_t;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">042</span>: ctypedef object Index_t</pre>
<pre class='cython code score-0 '>typedef PyObject *__pyx_t_7zipline_4data_9_equities_Index_t;
</pre><pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-173" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">047</span>: cpdef _compute_row_slices(dict asset_starts_absolute,</pre>
<pre class='cython code score-173 '>static PyObject *__pyx_pw_7zipline_4data_9_equities_1_compute_row_slices(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyObject *__pyx_f_7zipline_4data_9_equities__compute_row_slices(PyObject *__pyx_v_asset_starts_absolute, PyObject *__pyx_v_asset_ends_absolute, PyObject *__pyx_v_asset_starts_calendar, __pyx_t_5numpy_intp_t __pyx_v_query_start, __pyx_t_5numpy_intp_t __pyx_v_query_end, __pyx_t_7zipline_4data_9_equities_Index_t __pyx_v_requested_assets, CYTHON_UNUSED int __pyx_skip_dispatch) {
  __pyx_t_5numpy_intp_t __pyx_v_nassets;
  PyArrayObject *__pyx_v_first_row_a = 0;
  PyArrayObject *__pyx_v_last_row_a = 0;
  PyArrayObject *__pyx_v_offset_a = 0;
  __pyx_t_5numpy_intp_t __pyx_v_i;
  __pyx_t_5numpy_intp_t __pyx_v_asset;
  __pyx_t_5numpy_intp_t __pyx_v_asset_start_data;
  __pyx_t_5numpy_intp_t __pyx_v_asset_end_data;
  __pyx_t_5numpy_intp_t __pyx_v_asset_start_calendar;
  __pyx_t_5numpy_intp_t __pyx_v_asset_end_calendar;
  __pyx_t_5numpy_uint8_t __pyx_v_any_hits;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_first_row_a;
  __Pyx_Buffer __pyx_pybuffer_first_row_a;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_last_row_a;
  __Pyx_Buffer __pyx_pybuffer_last_row_a;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_offset_a;
  __Pyx_Buffer __pyx_pybuffer_offset_a;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__11)
  <span class='trace'>__Pyx_TraceCall</span>("_compute_row_slices", __pyx_f[0], 47, 0, <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L1_error)</span>);
  __pyx_pybuffer_first_row_a.pybuffer.buf = NULL;
  __pyx_pybuffer_first_row_a.refcount = 0;
  __pyx_pybuffernd_first_row_a.data = NULL;
  __pyx_pybuffernd_first_row_a.rcbuffer = &amp;__pyx_pybuffer_first_row_a;
  __pyx_pybuffer_last_row_a.pybuffer.buf = NULL;
  __pyx_pybuffer_last_row_a.refcount = 0;
  __pyx_pybuffernd_last_row_a.data = NULL;
  __pyx_pybuffernd_last_row_a.rcbuffer = &amp;__pyx_pybuffer_last_row_a;
  __pyx_pybuffer_offset_a.pybuffer.buf = NULL;
  __pyx_pybuffer_offset_a.refcount = 0;
  __pyx_pybuffernd_offset_a.data = NULL;
  __pyx_pybuffernd_offset_a.rcbuffer = &amp;__pyx_pybuffer_offset_a;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._compute_row_slices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_first_row_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_last_row_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_offset_a);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7zipline_4data_9_equities_1_compute_row_slices(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_7zipline_4data_9_equities__compute_row_slices, "\n    Core indexing functionality for loading raw data from bcolz.\n\n    For each asset in requested assets, computes three values:\n\n    1.) The index in the raw bcolz data of first row to load.\n    2.) The index in the raw bcolz data of the last row to load.\n    3.) The index in the dates of our query corresponding to the first row for\n        each asset. This is non-zero iff the asset's lifetime begins partway\n        through the requested query dates.\n\n    Values for unknown sids will be populated with a value of -1.\n\n    Parameters\n    ----------\n    asset_starts_absolute : dict\n        Dictionary containing the index of the first row of each asset in the\n        bcolz file from which we will query.\n    asset_ends_absolute : dict\n        Dictionary containing the index of the last row of each asset in the\n        bcolz file from which we will query.\n    asset_starts_calendar : dict\n        Dictionary containing the index of in our calendar corresponding to the\n        start date of each asset\n    query_start : intp\n        Start index in our calendar of the dates for which we're querying.\n    query_end : intp\n        End index in our calendar of the dates for which we're querying.\n    requested_assets : pandas.Index\n        The assets for which we want to load data.\n\n    Returns\n    -------\n    first_rows, last_rows, offsets : 3-tuple of ndarrays\n    ");
static PyMethodDef __pyx_mdef_7zipline_4data_9_equities_1_compute_row_slices = {"_compute_row_slices", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_7zipline_4data_9_equities_1_compute_row_slices, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_7zipline_4data_9_equities__compute_row_slices};
static PyObject *__pyx_pw_7zipline_4data_9_equities_1_compute_row_slices(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_asset_starts_absolute = 0;
  PyObject *__pyx_v_asset_ends_absolute = 0;
  PyObject *__pyx_v_asset_starts_calendar = 0;
  __pyx_t_5numpy_intp_t __pyx_v_query_start;
  __pyx_t_5numpy_intp_t __pyx_v_query_end;
  __pyx_t_7zipline_4data_9_equities_Index_t __pyx_v_requested_assets = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_compute_row_slices (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_asset_starts_absolute,&amp;__pyx_n_s_asset_ends_absolute,&amp;__pyx_n_s_asset_starts_calendar,&amp;__pyx_n_s_query_start,&amp;__pyx_n_s_query_end,&amp;__pyx_n_s_requested_assets,0};
  PyObject* values[6] = {0,0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asset_starts_absolute)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asset_ends_absolute)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, 1); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asset_starts_calendar)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, 2); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_query_start)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, 3); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_query_end)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[4]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, 4); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_requested_assets)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[5]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, 5); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_compute_row_slices") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 6)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
      values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
      values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
    }
    __pyx_v_asset_starts_absolute = ((PyObject*)values[0]);
    __pyx_v_asset_ends_absolute = ((PyObject*)values[1]);
    __pyx_v_asset_starts_calendar = ((PyObject*)values[2]);
    __pyx_v_query_start = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(values[3]); if (unlikely((__pyx_v_query_start == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 50, __pyx_L3_error)</span>
    __pyx_v_query_end = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(values[4]); if (unlikely((__pyx_v_query_end == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 51, __pyx_L3_error)</span>
    __pyx_v_requested_assets = ((__pyx_t_7zipline_4data_9_equities_Index_t)values[5]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_compute_row_slices", 1, 6, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._compute_row_slices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_asset_starts_absolute), (&amp;PyDict_Type), 1, "asset_starts_absolute", 1))) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_asset_ends_absolute), (&amp;PyDict_Type), 1, "asset_ends_absolute", 1))) <span class='error_goto'>__PYX_ERR(0, 48, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_asset_starts_calendar), (&amp;PyDict_Type), 1, "asset_starts_calendar", 1))) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7zipline_4data_9_equities__compute_row_slices(__pyx_self, __pyx_v_asset_starts_absolute, __pyx_v_asset_ends_absolute, __pyx_v_asset_starts_calendar, __pyx_v_query_start, __pyx_v_query_end, __pyx_v_requested_assets);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_4data_9_equities__compute_row_slices(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_asset_starts_absolute, PyObject *__pyx_v_asset_ends_absolute, PyObject *__pyx_v_asset_starts_calendar, __pyx_t_5numpy_intp_t __pyx_v_query_start, __pyx_t_5numpy_intp_t __pyx_v_query_end, __pyx_t_7zipline_4data_9_equities_Index_t __pyx_v_requested_assets) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__11)
  <span class='trace'>__Pyx_TraceCall</span>("_compute_row_slices (wrapper)", __pyx_f[0], 47, 0, <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_7zipline_4data_9_equities__compute_row_slices(__pyx_v_asset_starts_absolute, __pyx_v_asset_ends_absolute, __pyx_v_asset_starts_calendar, __pyx_v_query_start, __pyx_v_query_end, __pyx_v_requested_assets, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._compute_row_slices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_asset_starts_absolute, __pyx_n_s_asset_ends_absolute, __pyx_n_s_asset_starts_calendar, __pyx_n_s_query_start, __pyx_n_s_query_end, __pyx_n_s_requested_assets);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_7zipline_4data_9_equities_1_compute_row_slices, 0, __pyx_n_s_compute_row_slices, NULL, __pyx_n_s_zipline_data__equities, __pyx_d, ((PyObject *)__pyx_codeobj__11));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_compute_row_slices, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 47, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__11 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_zipline_data__equities_pyx, __pyx_n_s_compute_row_slices, 47, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 47, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">048</span>:                           dict asset_ends_absolute,</pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:                           dict asset_starts_calendar,</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>:                           intp_t query_start,</pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:                           intp_t query_end,</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:                           Index_t requested_assets):</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:     Core indexing functionality for loading raw data from bcolz.</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:     For each asset in requested assets, computes three values:</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     1.) The index in the raw bcolz data of first row to load.</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     2.) The index in the raw bcolz data of the last row to load.</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:     3.) The index in the dates of our query corresponding to the first row for</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:         each asset. This is non-zero iff the asset's lifetime begins partway</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:         through the requested query dates.</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:     Values for unknown sids will be populated with a value of -1.</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:     asset_starts_absolute : dict</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:         Dictionary containing the index of the first row of each asset in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:         bcolz file from which we will query.</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     asset_ends_absolute : dict</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:         Dictionary containing the index of the last row of each asset in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:         bcolz file from which we will query.</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:     asset_starts_calendar : dict</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:         Dictionary containing the index of in our calendar corresponding to the</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:         start date of each asset</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     query_start : intp</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:         Start index in our calendar of the dates for which we're querying.</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     query_end : intp</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:         End index in our calendar of the dates for which we're querying.</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:     requested_assets : pandas.Index</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:         The assets for which we want to load data.</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:     first_rows, last_rows, offsets : 3-tuple of ndarrays</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:     cdef:</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:         intp_t nassets = len(requested_assets)</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_requested_assets));<span class='error_goto'> if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 89, __pyx_L1_error)</span>
  __pyx_v_nassets = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">090</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:         # For each sid, we need to compute the following:</pre>
<pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:         ndarray[dtype=intp_t, ndim=1] first_row_a = full(nassets, -1, dtype=intp)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_full);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_nassets);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_neg_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_neg_1)) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_intp_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_first_row_a = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_first_row_a.diminfo[0].strides = __pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_first_row_a.diminfo[0].shape = __pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_first_row_a = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:         ndarray[dtype=intp_t, ndim=1] last_row_a = full(nassets, -1, dtype=intp)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_full);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_nassets);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_neg_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_neg_1)) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_intp_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_last_row_a = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_last_row_a.diminfo[0].strides = __pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_last_row_a.diminfo[0].shape = __pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_last_row_a = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:         ndarray[dtype=intp_t, ndim=1] offset_a = full(nassets, -1, dtype=intp)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_full);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_nassets);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_neg_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_neg_1)) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_intp);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_intp_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_offset_a = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_offset_a.diminfo[0].strides = __pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_offset_a.diminfo[0].shape = __pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_offset_a = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">095</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>:         # Loop variables.</pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>:         intp_t i</pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>:         intp_t asset</pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>:         intp_t asset_start_data</pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>:         intp_t asset_end_data</pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:         intp_t asset_start_calendar</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:         intp_t asset_end_calendar</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>:         # Flag to check whether we should raise an error because we don't know</pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:         # about any of the requested sids.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">106</span>:         uint8_t any_hits = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_any_hits = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">107</span>: </pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">108</span>:     for i, asset in enumerate(requested_assets):</pre>
<pre class='cython code score-56 '>  __pyx_t_9 = 0;
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_requested_assets))) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_requested_assets))) {
    __pyx_t_5 = ((PyObject *)__pyx_v_requested_assets); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    __pyx_t_1 = 0;
    __pyx_t_10 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_requested_assets));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
  }
  for (;;) {
    if (likely(!__pyx_t_10)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_1 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1++; if (unlikely((0 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
        #else
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_5, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_1 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_1); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_1++; if (unlikely((0 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
        #else
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_5, __pyx_t_1); __pyx_t_1++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_10(__pyx_t_5);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
        }
        break;
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    }
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(__pyx_t_3); if (unlikely((__pyx_t_11 == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_asset = __pyx_t_11;
    __pyx_v_i = __pyx_t_9;
    __pyx_t_9 = (__pyx_t_9 + 1);
/* … */
    __pyx_L3_continue:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>:         if asset not in asset_starts_absolute:</pre>
<pre class='cython code score-10 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (unlikely(__pyx_v_asset_starts_absolute == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
      <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
    }
    __pyx_t_12 = (<span class='pyx_c_api'>__Pyx_PyDict_ContainsTF</span>(__pyx_t_3, __pyx_v_asset_starts_absolute, Py_NE)); if (unlikely((__pyx_t_12 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_12) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">110</span>:             # This is an unknown asset, leave its slot empty.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>:             continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">112</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:         any_hits = 1</pre>
<pre class='cython code score-0 '>    __pyx_v_any_hits = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>: </pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>:         asset_start_data = asset_starts_absolute[asset]</pre>
<pre class='cython code score-18 '>    if (unlikely(__pyx_v_asset_starts_absolute == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
    }
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_asset_starts_absolute, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(__pyx_t_4); if (unlikely((__pyx_t_11 == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_asset_start_data = __pyx_t_11;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">116</span>:         asset_end_data = asset_ends_absolute[asset]</pre>
<pre class='cython code score-18 '>    if (unlikely(__pyx_v_asset_ends_absolute == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 116, __pyx_L1_error)</span>
    }
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_asset_ends_absolute, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 116, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(__pyx_t_3); if (unlikely((__pyx_t_11 == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 116, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_asset_end_data = __pyx_t_11;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">117</span>:         asset_start_calendar = asset_starts_calendar[asset]</pre>
<pre class='cython code score-18 '>    if (unlikely(__pyx_v_asset_starts_calendar == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 117, __pyx_L1_error)</span>
    }
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 117, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_asset_starts_calendar, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 117, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_npy_intp</span>(__pyx_t_4); if (unlikely((__pyx_t_11 == ((npy_intp)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 117, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_asset_start_calendar = __pyx_t_11;
</pre><pre class="cython line score-0">&#xA0;<span class="">118</span>:         asset_end_calendar = (</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">119</span>:             asset_start_calendar + (asset_end_data - asset_start_data)</pre>
<pre class='cython code score-0 '>    __pyx_v_asset_end_calendar = (__pyx_v_asset_start_calendar + (__pyx_v_asset_end_data - __pyx_v_asset_start_data));
</pre><pre class="cython line score-0">&#xA0;<span class="">120</span>:         )</pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:         # If the asset started during the query, then start with the asset's</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         # first row.</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:         # Otherwise start with the asset's first row + the number of rows</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         # before the query on which the asset existed.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">126</span>:         first_row_a[i] = (</pre>
<pre class='cython code score-0 '>    __pyx_t_15 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_intp_t *, __pyx_pybuffernd_first_row_a.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_first_row_a.diminfo[0].strides) = (__pyx_v_asset_start_data + __pyx_t_14);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">127</span>:             asset_start_data + max(0, (query_start - asset_start_calendar))</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (__pyx_v_query_start - __pyx_v_asset_start_calendar);
    __pyx_t_13 = 0;
    __pyx_t_12 = (__pyx_t_11 &gt; __pyx_t_13);
    if (__pyx_t_12) {
      __pyx_t_14 = __pyx_t_11;
    } else {
      __pyx_t_14 = __pyx_t_13;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">128</span>:         )</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:         # If the asset ended during the query, the end with the asset's last</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:         # row.</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:         # Otherwise, end with the asset's last row minus the number of rows</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:         # after the query for which the asset</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:         last_row_a[i] = (</pre>
<pre class='cython code score-0 '>    __pyx_t_15 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_intp_t *, __pyx_pybuffernd_last_row_a.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_last_row_a.diminfo[0].strides) = (__pyx_v_asset_end_data - __pyx_t_11);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:             asset_end_data - max(0, asset_end_calendar - query_end)</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = (__pyx_v_asset_end_calendar - __pyx_v_query_end);
    __pyx_t_13 = 0;
    __pyx_t_12 = (__pyx_t_14 &gt; __pyx_t_13);
    if (__pyx_t_12) {
      __pyx_t_11 = __pyx_t_14;
    } else {
      __pyx_t_11 = __pyx_t_13;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">135</span>:         )</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:         # If the asset existed on or before the query, no offset.</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:         # Otherwise, offset by the number of rows in the query in which the</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:         # asset did not yet exist.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:         offset_a[i] = max(0, asset_start_calendar - query_start)</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (__pyx_v_asset_start_calendar - __pyx_v_query_start);
    __pyx_t_13 = 0;
    __pyx_t_12 = (__pyx_t_11 &gt; __pyx_t_13);
    if (__pyx_t_12) {
      __pyx_t_14 = __pyx_t_11;
    } else {
      __pyx_t_14 = __pyx_t_13;
    }
    __pyx_t_15 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_intp_t *, __pyx_pybuffernd_offset_a.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_offset_a.diminfo[0].strides) = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">140</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:     if not any_hits:</pre>
<pre class='cython code score-0 '>  __pyx_t_12 = (!(__pyx_v_any_hits != 0));
  if (unlikely(__pyx_t_12)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">142</span>:         raise ValueError('At least one valid asset id is required.')</pre>
<pre class='cython code score-10 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 142, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__12 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_At_least_one_valid_asset_id_is_r);<span class='error_goto'> if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 142, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__12);
</pre><pre class="cython line score-0">&#xA0;<span class="">143</span>: </pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:     return first_row_a, last_row_a, offset_a</pre>
<pre class='cython code score-15 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_first_row_a);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_v_first_row_a);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, ((PyObject *)__pyx_v_first_row_a))) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_last_row_a);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_v_last_row_a);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, ((PyObject *)__pyx_v_last_row_a))) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_offset_a);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_v_offset_a);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 2, ((PyObject *)__pyx_v_offset_a))) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">145</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-189" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>: cpdef _read_bcolz_data(ctable_t table,</pre>
<pre class='cython code score-189 '>static PyObject *__pyx_pw_7zipline_4data_9_equities_3_read_bcolz_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyObject *__pyx_f_7zipline_4data_9_equities__read_bcolz_data(__pyx_t_7zipline_4data_9_equities_ctable_t __pyx_v_table, PyObject *__pyx_v_shape, PyObject *__pyx_v_columns, __Pyx_memviewslice __pyx_v_first_rows, __Pyx_memviewslice __pyx_v_last_rows, __Pyx_memviewslice __pyx_v_offsets, PyBoolObject *__pyx_v_read_all, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_v_nassets;
  PyObject *__pyx_v_column_name = 0;
  __pyx_t_7zipline_4data_9_equities_carray_t __pyx_v_carray = 0;
  PyArrayObject *__pyx_v_raw_data = 0;
  PyArrayObject *__pyx_v_outbuf = 0;
  PyArrayObject *__pyx_v_where_nan = 0;
  PyArrayObject *__pyx_v_outbuf_as_float = 0;
  __pyx_t_5numpy_intp_t __pyx_v_asset;
  __pyx_t_5numpy_intp_t __pyx_v_first_row;
  __pyx_t_5numpy_intp_t __pyx_v_last_row;
  __pyx_t_5numpy_intp_t __pyx_v_offset;
  PyObject *__pyx_v_results = 0;
  CYTHON_UNUSED PyObject *__pyx_v_ndays = NULL;
  CYTHON_UNUSED __pyx_t_5numpy_intp_t __pyx_v_out_start;
  CYTHON_UNUSED __pyx_t_5numpy_intp_t __pyx_v_out_end;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_outbuf;
  __Pyx_Buffer __pyx_pybuffer_outbuf;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_outbuf_as_float;
  __Pyx_Buffer __pyx_pybuffer_outbuf_as_float;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_raw_data;
  __Pyx_Buffer __pyx_pybuffer_raw_data;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_where_nan;
  __Pyx_Buffer __pyx_pybuffer_where_nan;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__13)
  <span class='trace'>__Pyx_TraceCall</span>("_read_bcolz_data", __pyx_f[0], 149, 0, <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>);
  __pyx_pybuffer_raw_data.pybuffer.buf = NULL;
  __pyx_pybuffer_raw_data.refcount = 0;
  __pyx_pybuffernd_raw_data.data = NULL;
  __pyx_pybuffernd_raw_data.rcbuffer = &amp;__pyx_pybuffer_raw_data;
  __pyx_pybuffer_outbuf.pybuffer.buf = NULL;
  __pyx_pybuffer_outbuf.refcount = 0;
  __pyx_pybuffernd_outbuf.data = NULL;
  __pyx_pybuffernd_outbuf.rcbuffer = &amp;__pyx_pybuffer_outbuf;
  __pyx_pybuffer_where_nan.pybuffer.buf = NULL;
  __pyx_pybuffer_where_nan.refcount = 0;
  __pyx_pybuffernd_where_nan.data = NULL;
  __pyx_pybuffernd_where_nan.rcbuffer = &amp;__pyx_pybuffer_where_nan;
  __pyx_pybuffer_outbuf_as_float.pybuffer.buf = NULL;
  __pyx_pybuffer_outbuf_as_float.refcount = 0;
  __pyx_pybuffernd_outbuf_as_float.data = NULL;
  __pyx_pybuffernd_outbuf_as_float.rcbuffer = &amp;__pyx_pybuffer_outbuf_as_float;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._read_bcolz_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_column_name);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_carray);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_raw_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_outbuf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_where_nan);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_outbuf_as_float);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_results);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ndays);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_7zipline_4data_9_equities_3_read_bcolz_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_7zipline_4data_9_equities_2_read_bcolz_data, "\n    Load raw bcolz data for the given columns and indices.\n\n    Parameters\n    ----------\n    table : bcolz.ctable\n        The table from which to read.\n    shape : tuple (length 2)\n        The shape of the expected output arrays.\n    columns : list[str]\n        List of column names to read.\n\n    first_rows : ndarray[intp]\n    last_rows : ndarray[intp]\n    offsets : ndarray[intp\n        Arrays in the format returned by _compute_row_slices.\n    read_all : bool\n        Whether to read_all sid data at once, or to read a silce from the\n        carray for each sid.\n\n    Returns\n    -------\n    results : list of ndarray\n        A 2D array of shape `shape` for each column in `columns`.\n    ");
static PyMethodDef __pyx_mdef_7zipline_4data_9_equities_3_read_bcolz_data = {"_read_bcolz_data", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_7zipline_4data_9_equities_3_read_bcolz_data, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_7zipline_4data_9_equities_2_read_bcolz_data};
static PyObject *__pyx_pw_7zipline_4data_9_equities_3_read_bcolz_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __pyx_t_7zipline_4data_9_equities_ctable_t __pyx_v_table = 0;
  PyObject *__pyx_v_shape = 0;
  PyObject *__pyx_v_columns = 0;
  __Pyx_memviewslice __pyx_v_first_rows = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_last_rows = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_offsets = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyBoolObject *__pyx_v_read_all = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_read_bcolz_data (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_table,&amp;__pyx_n_s_shape,&amp;__pyx_n_s_columns,&amp;__pyx_n_s_first_rows,&amp;__pyx_n_s_last_rows,&amp;__pyx_n_s_offsets,&amp;__pyx_n_s_read_all,0};
  PyObject* values[7] = {0,0,0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_table)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shape)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 1); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_columns)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 2); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_first_rows)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 3); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_last_rows)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[4]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 4); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_offsets)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[5]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 5); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_read_all)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[6]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, 6); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_read_bcolz_data") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 7)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
      values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
      values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
      values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
    }
    __pyx_v_table = ((__pyx_t_7zipline_4data_9_equities_ctable_t)values[0]);
    __pyx_v_shape = ((PyObject*)values[1]);
    __pyx_v_columns = ((PyObject*)values[2]);
    __pyx_v_first_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_intp_t(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_first_rows.memview)) __PYX_ERR(0, 152, __pyx_L3_error)</span>
    __pyx_v_last_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_intp_t(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_last_rows.memview)) __PYX_ERR(0, 153, __pyx_L3_error)</span>
    __pyx_v_offsets = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_intp_t(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_offsets.memview)) __PYX_ERR(0, 154, __pyx_L3_error)</span>
    __pyx_v_read_all = ((PyBoolObject *)values[6]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_read_bcolz_data", 1, 7, 7, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_first_rows, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_last_rows, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_offsets, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._read_bcolz_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shape), (&amp;PyTuple_Type), 1, "shape", 1))) <span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_columns), (&amp;PyList_Type), 1, "columns", 1))) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_read_all), __pyx_ptype_7cpython_4bool_bool, 1, "read_all", 0))) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_7zipline_4data_9_equities_2_read_bcolz_data(__pyx_self, __pyx_v_table, __pyx_v_shape, __pyx_v_columns, __pyx_v_first_rows, __pyx_v_last_rows, __pyx_v_offsets, __pyx_v_read_all);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_first_rows, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_last_rows, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_offsets, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_4data_9_equities_2_read_bcolz_data(CYTHON_UNUSED PyObject *__pyx_self, __pyx_t_7zipline_4data_9_equities_ctable_t __pyx_v_table, PyObject *__pyx_v_shape, PyObject *__pyx_v_columns, __Pyx_memviewslice __pyx_v_first_rows, __Pyx_memviewslice __pyx_v_last_rows, __Pyx_memviewslice __pyx_v_offsets, PyBoolObject *__pyx_v_read_all) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__13)
  <span class='trace'>__Pyx_TraceCall</span>("_read_bcolz_data (wrapper)", __pyx_f[0], 149, 0, <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_first_rows.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("first_rows"); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_last_rows.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("last_rows"); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span> }
  if (unlikely(!__pyx_v_offsets.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("offsets"); <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span> }
  __pyx_t_1 = __pyx_f_7zipline_4data_9_equities__read_bcolz_data(__pyx_v_table, __pyx_v_shape, __pyx_v_columns, __pyx_v_first_rows, __pyx_v_last_rows, __pyx_v_offsets, __pyx_v_read_all, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline.data._equities._read_bcolz_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__27 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_table, __pyx_n_s_shape, __pyx_n_s_columns, __pyx_n_s_first_rows, __pyx_n_s_last_rows, __pyx_n_s_offsets, __pyx_n_s_read_all);<span class='error_goto'> if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__27);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__27);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_7zipline_4data_9_equities_3_read_bcolz_data, 0, __pyx_n_s_read_bcolz_data, NULL, __pyx_n_s_zipline_data__equities, __pyx_d, ((PyObject *)__pyx_codeobj__13));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_read_bcolz_data, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">150</span>:                        tuple shape,</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:                        list columns,</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:                        intp_t[:] first_rows,</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:                        intp_t[:] last_rows,</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:                        intp_t[:] offsets,</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:                        bool read_all):</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:     Load raw bcolz data for the given columns and indices.</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:     Parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:     ----------</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:     table : bcolz.ctable</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>:         The table from which to read.</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     shape : tuple (length 2)</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:         The shape of the expected output arrays.</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:     columns : list[str]</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>:         List of column names to read.</pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>:     first_rows : ndarray[intp]</pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:     last_rows : ndarray[intp]</pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>:     offsets : ndarray[intp</pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>:         Arrays in the format returned by _compute_row_slices.</pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:     read_all : bool</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:         Whether to read_all sid data at once, or to read a silce from the</pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:         carray for each sid.</pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>:     -------</pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>:     results : list of ndarray</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>:         A 2D array of shape `shape` for each column in `columns`.</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:     cdef:</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:         int nassets</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>:         str column_name</pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>:         carray_t carray</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>:         ndarray[dtype=uint64_t, ndim=1] raw_data</pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>:         ndarray[dtype=uint64_t, ndim=2] outbuf</pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>:         ndarray[dtype=uint8_t, ndim=2, cast=True] where_nan</pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:         ndarray[dtype=float64_t, ndim=2] outbuf_as_float</pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>:         intp_t asset</pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>:         intp_t out_idx</pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>:         intp_t raw_idx</pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>:         intp_t first_row</pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>:         intp_t last_row</pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>:         intp_t offset</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:         list results = []</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_results = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">196</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:     ndays = shape[0]</pre>
<pre class='cython code score-7 '>  if (unlikely(__pyx_v_shape == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
    <span class='error_goto'>__PYX_ERR(0, 197, __pyx_L1_error)</span>
  }
  __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_v_shape, 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_ndays = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:     nassets = shape[1]</pre>
<pre class='cython code score-13 '>  if (unlikely(__pyx_v_shape == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
    <span class='error_goto'>__PYX_ERR(0, 198, __pyx_L1_error)</span>
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_v_shape, 1)); if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 198, __pyx_L1_error)</span>
  __pyx_v_nassets = __pyx_t_2;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>:     if not nassets== len(first_rows) == len(last_rows) == len(offsets):</pre>
<pre class='cython code score-6 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_first_rows); 
  __pyx_t_4 = (__pyx_v_nassets == __pyx_t_3);
  if (__pyx_t_4) {
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_last_rows); 
    __pyx_t_4 = (__pyx_t_3 == __pyx_t_5);
    if (__pyx_t_4) {
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_offsets); 
      __pyx_t_4 = (__pyx_t_5 == __pyx_t_6);
    }
  }
  __pyx_t_7 = (!__pyx_t_4);
  if (unlikely(__pyx_t_7)) {
/* … */
  }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:         raise ValueError("Incompatible index arrays.")</pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 200, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__14 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_Incompatible_index_arrays);<span class='error_goto'> if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 200, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__14);
</pre><pre class="cython line score-0">&#xA0;<span class="">201</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:     for column_name in columns:</pre>
<pre class='cython code score-21 '>  if (unlikely(__pyx_v_columns == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
    <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
  }
  __pyx_t_1 = __pyx_v_columns; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_t_3 = 0;
  for (;;) {
    {
      Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_1);
      #if !CYTHON_ASSUME_SAFE_MACROS
      if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
      #endif
      if (__pyx_t_3 &gt;= __pyx_temp) break;
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_3++; if (unlikely((0 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
    #else
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 202, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    #endif
    if (!(likely(<span class='py_c_api'>PyUnicode_CheckExact</span>(__pyx_t_8))||((__pyx_t_8) == Py_None) || <span class='pyx_c_api'>__Pyx_RaiseUnexpectedTypeError</span>("unicode", __pyx_t_8))) <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_column_name, ((PyObject*)__pyx_t_8));
    __pyx_t_8 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:         outbuf = zeros(shape=shape, dtype=uint64)</pre>
<pre class='cython code score-42 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_shape, __pyx_v_shape) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_uint64);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_dtype, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_empty_tuple, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 203, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_10) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
    __pyx_t_11 = ((PyArrayObject *)__pyx_t_10);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_2 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_outbuf, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
        }
        __pyx_t_12 = __pyx_t_13 = __pyx_t_14 = 0;
      }
      __pyx_pybuffernd_outbuf.diminfo[0].strides = __pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_outbuf.diminfo[0].shape = __pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_outbuf.diminfo[1].strides = __pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_outbuf.diminfo[1].shape = __pyx_pybuffernd_outbuf.rcbuffer-&gt;pybuffer.shape[1];
      if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>
    }
    __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_outbuf, ((PyArrayObject *)__pyx_t_10));
    __pyx_t_10 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:         if read_all:</pre>
<pre class='cython code score-2 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_read_all)); if (unlikely((__pyx_t_7 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>
    if (__pyx_t_7) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:             raw_data = table[column_name][:]</pre>
<pre class='cython code score-26 '>      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_table), __pyx_v_column_name);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 205, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(__pyx_t_10, 0, 0, NULL, NULL, &amp;__pyx_slice__5, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 205, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (!(likely(((__pyx_t_9) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_9, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 205, __pyx_L1_error)</span>
      __pyx_t_15 = ((PyArrayObject *)__pyx_t_9);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer);
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_15, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_2 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_raw_data, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
          }
          __pyx_t_14 = __pyx_t_13 = __pyx_t_12 = 0;
        }
        __pyx_pybuffernd_raw_data.diminfo[0].strides = __pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_raw_data.diminfo[0].shape = __pyx_pybuffernd_raw_data.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 205, __pyx_L1_error)</span>
      }
      __pyx_t_15 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_raw_data, ((PyArrayObject *)__pyx_t_9));
      __pyx_t_9 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:             for asset in range(nassets):</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_nassets;
      __pyx_t_16 = __pyx_t_2;
      for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
        __pyx_v_asset = __pyx_t_17;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:                 first_row = first_rows[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_first_row = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_first_rows.data + __pyx_t_18 * __pyx_v_first_rows.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:                 if first_row == -1:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = (__pyx_v_first_row == -1L);
        if (__pyx_t_7) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">210</span>:                     # This is an unknown asset, leave its slot empty.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L7_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">212</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:                 last_row = last_rows[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_last_row = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_last_rows.data + __pyx_t_18 * __pyx_v_last_rows.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:                 offset = offsets[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_offset = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_18 * __pyx_v_offsets.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">215</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:                 if first_row &lt;= last_row:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = (__pyx_v_first_row &lt;= __pyx_v_last_row);
        if (__pyx_t_7) {
/* … */
          goto __pyx_L10;
        }
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:                     outbuf[offset:offset + (last_row + 1 - first_row), asset] =\</pre>
<pre class='cython code score-29 '>          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>((__pyx_v_offset + ((__pyx_v_last_row + 1) - __pyx_v_first_row)));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_19 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_8, __pyx_t_9, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_19)) <span class='error_goto'>__PYX_ERR(0, 217, __pyx_L1_error)</span>;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
          if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 217, __pyx_L1_error)</span>;
          __pyx_t_19 = 0;
          __pyx_t_9 = 0;
          if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_outbuf), __pyx_t_8, __pyx_t_10) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 217, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:                         raw_data[first_row:last_row + 1]</pre>
<pre class='cython code score-14 '>          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_first_row);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>((__pyx_v_last_row + 1));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
          __pyx_t_8 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_9, __pyx_t_10, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_raw_data), __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">219</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:                     continue</pre>
<pre class='cython code score-0 '>        /*else*/ {
          goto __pyx_L7_continue;
        }
        __pyx_L10:;
        __pyx_L7_continue:;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">221</span>:         else:</pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:             carray = table[column_name]</pre>
<pre class='cython code score-3 '>    /*else*/ {
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_table), __pyx_v_column_name);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 222, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_carray, ((__pyx_t_7zipline_4data_9_equities_carray_t)__pyx_t_10));
      __pyx_t_10 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:             for asset in range(nassets):</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_nassets;
      __pyx_t_16 = __pyx_t_2;
      for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
        __pyx_v_asset = __pyx_t_17;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:                 first_row = first_rows[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_first_row = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_first_rows.data + __pyx_t_18 * __pyx_v_first_rows.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:                 if first_row == -1:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = (__pyx_v_first_row == -1L);
        if (__pyx_t_7) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">227</span>:                     # This is an unknown asset, leave its slot empty.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>:                     continue</pre>
<pre class='cython code score-0 '>          goto __pyx_L11_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">229</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:                 last_row = last_rows[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_last_row = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_last_rows.data + __pyx_t_18 * __pyx_v_last_rows.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:                 offset = offsets[asset]</pre>
<pre class='cython code score-0 '>        __pyx_t_18 = __pyx_v_asset;
        __pyx_v_offset = (*((__pyx_t_5numpy_intp_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_18 * __pyx_v_offsets.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:                 out_start = offset</pre>
<pre class='cython code score-0 '>        __pyx_v_out_start = __pyx_v_offset;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:                 out_end = (last_row - first_row) + offset + 1</pre>
<pre class='cython code score-0 '>        __pyx_v_out_end = (((__pyx_v_last_row - __pyx_v_first_row) + __pyx_v_offset) + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:                 if first_row &lt;= last_row:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = (__pyx_v_first_row &lt;= __pyx_v_last_row);
        if (__pyx_t_7) {
/* … */
          goto __pyx_L14;
        }
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>:                     outbuf[offset:offset + (last_row + 1 - first_row), asset] =\</pre>
<pre class='cython code score-29 '>          __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_offset);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>((__pyx_v_offset + ((__pyx_v_last_row + 1) - __pyx_v_first_row)));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_19 = <span class='py_c_api'>PySlice_New</span>(__pyx_t_8, __pyx_t_9, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_npy_intp</span>(__pyx_v_asset);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
          if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_19)) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>;
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
          if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>;
          __pyx_t_19 = 0;
          __pyx_t_9 = 0;
          if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_outbuf), __pyx_t_8, __pyx_t_10) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>:                         carray[first_row:last_row + 1]</pre>
<pre class='cython code score-2 '>          __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(((PyObject *)__pyx_v_carray), __pyx_v_first_row, (__pyx_v_last_row + 1), NULL, NULL, NULL, 1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 236, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
</pre><pre class="cython line score-0">&#xA0;<span class="">237</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:                     continue</pre>
<pre class='cython code score-0 '>        /*else*/ {
          goto __pyx_L11_continue;
        }
        __pyx_L14:;
        __pyx_L11_continue:;
      }
    }
    __pyx_L6:;
</pre><pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">240</span>:         if column_name in {'open', 'high', 'low', 'close'}:</pre>
<pre class='cython code score-10 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_column_name);
    __pyx_t_20 = __pyx_v_column_name;
    __pyx_t_4 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_20, __pyx_n_u_open, Py_EQ)); if (unlikely((__pyx_t_4 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
    if (!__pyx_t_4) {
    } else {
      __pyx_t_7 = __pyx_t_4;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_4 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_20, __pyx_n_u_high, Py_EQ)); if (unlikely((__pyx_t_4 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
    if (!__pyx_t_4) {
    } else {
      __pyx_t_7 = __pyx_t_4;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_4 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_20, __pyx_n_u_low, Py_EQ)); if (unlikely((__pyx_t_4 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
    if (!__pyx_t_4) {
    } else {
      __pyx_t_7 = __pyx_t_4;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_4 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_20, __pyx_n_u_close, Py_EQ)); if (unlikely((__pyx_t_4 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
    __pyx_t_7 = __pyx_t_4;
    __pyx_L16_bool_binop_done:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    __pyx_t_4 = __pyx_t_7;
    if (__pyx_t_4) {
/* … */
      goto __pyx_L15;
    }
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:             where_nan = (outbuf == 0)</pre>
<pre class='cython code score-24 '>      __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_outbuf), __pyx_int_0, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 241, __pyx_L1_error)
      if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 241, __pyx_L1_error)</span>
      __pyx_t_21 = ((PyArrayObject *)__pyx_t_10);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer);
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_21, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 1, __pyx_stack);
        if (unlikely(__pyx_t_2 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_where_nan, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 1, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
          }
          __pyx_t_12 = __pyx_t_13 = __pyx_t_14 = 0;
        }
        __pyx_pybuffernd_where_nan.diminfo[0].strides = __pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_where_nan.diminfo[0].shape = __pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_where_nan.diminfo[1].strides = __pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_where_nan.diminfo[1].shape = __pyx_pybuffernd_where_nan.rcbuffer-&gt;pybuffer.shape[1];
        if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span>
      }
      __pyx_t_21 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_where_nan, ((PyArrayObject *)__pyx_t_10));
      __pyx_t_10 = 0;
</pre><pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:             outbuf_as_float = outbuf.astype(float64) * .001</pre>
<pre class='cython code score-46 '>      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_outbuf), __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __pyx_t_19 = NULL;
      __pyx_t_22 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
        __pyx_t_19 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
        if (likely(__pyx_t_19)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
          __pyx_t_22 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_19, __pyx_t_9};
        __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_8, __pyx_callargs+1-__pyx_t_22, 1+__pyx_t_22);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      }
      __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_10, __pyx_float__001);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
      __pyx_t_23 = ((PyArrayObject *)__pyx_t_8);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer);
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_23, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
        if (unlikely(__pyx_t_2 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_outbuf_as_float, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
          }
          __pyx_t_14 = __pyx_t_13 = __pyx_t_12 = 0;
        }
        __pyx_pybuffernd_outbuf_as_float.diminfo[0].strides = __pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_outbuf_as_float.diminfo[0].shape = __pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_outbuf_as_float.diminfo[1].strides = __pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_outbuf_as_float.diminfo[1].shape = __pyx_pybuffernd_outbuf_as_float.rcbuffer-&gt;pybuffer.shape[1];
        if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
      }
      __pyx_t_23 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_outbuf_as_float, ((PyArrayObject *)__pyx_t_8));
      __pyx_t_8 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:             outbuf_as_float[where_nan] = NAN</pre>
<pre class='cython code score-11 '>      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(NPY_NAN);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 243, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(((PyObject *)__pyx_v_outbuf_as_float), ((PyObject *)__pyx_v_where_nan), __pyx_t_8) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 243, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:             results.append(outbuf_as_float)</pre>
<pre class='cython code score-2 '>      __pyx_t_24 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_results, ((PyObject *)__pyx_v_outbuf_as_float));<span class='error_goto'> if (unlikely(__pyx_t_24 == ((int)-1))) __PYX_ERR(0, 244, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">245</span>:         else:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:             results.append(outbuf)</pre>
<pre class='cython code score-2 '>    /*else*/ {
      __pyx_t_24 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_results, ((PyObject *)__pyx_v_outbuf));<span class='error_goto'> if (unlikely(__pyx_t_24 == ((int)-1))) __PYX_ERR(0, 246, __pyx_L1_error)</span>
    }
    __pyx_L15:;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:     return results</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_results);
  __pyx_r = __pyx_v_results;
  goto __pyx_L0;
</pre></div></body></html>
